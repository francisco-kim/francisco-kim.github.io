<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-01-27 Thu 20:56 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Compositional ideas behind Fuga I</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Francisco Kim" />
<meta name="description" content="Musical analysis of the Fuga I."
 />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">Compositional ideas behind Fuga I</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgfaa8219">1. Introduction</a></li>
<li><a href="#org49f86d1">2. Music/Score</a></li>
<li><a href="#org2cc3b53">3. Structural analysis</a>
<ul>
<li><a href="#org807a874">3.1. Structure diagram</a></li>
<li><a href="#org45da66c">3.2. Score analysis</a>
<ul>
<li><a href="#orgcaecf68">3.2.1. Entries/episodes</a></li>
<li><a href="#orgbfc0c37">3.2.2. Subjects/countersujects and invertible counterpoint</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org143ace1">4. Specific details</a>
<ul>
<li><a href="#org570c1a2">4.1. Zenith/nadir of the piece</a></li>
<li><a href="#org8aa6218">4.2. The strong-beat tritone in the lower voices</a></li>
<li><a href="#org3701064">4.3. German sixth (übermässiger Quintsextakkord)</a></li>
<li><a href="#org5e7501f">4.4. Double sequence</a></li>
</ul>
</li>
<li><a href="#org2826d6c">5. Appendix: Computational Musicology</a>
<ul>
<li><a href="#orgd7fe132">5.1. Piano roll and other graphics</a></li>
<li><a href="#orgf39049d">5.2. Key center</a></li>
<li><a href="#org6c25ce9">5.3. Chords</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p align="right">
<b>Francisco Kim</b><br />
francisco.hk.kim@gmail.com<br />
</p>

<div id="outline-container-orgfaa8219" class="outline-2">
<h2 id="orgfaa8219"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This is a personal note of the musical ideas that were used in the composition of my Fuga I (all rights reserved, © 2020).<br />
<br />
</p>

<p>
In the composition of this fugue in D minor, the main idea was to use the <b>B-A-C-H motif</b> within the counterpoint rules of the Baroque period&#x2014;in particular in Bach's time. This means:<br />
</p>
<ul class="org-ul">
<li>avoid any parallel fifths/octaves and avoid direct fifths/octaves,<br /></li>
<li>avoid dissonances on strong/accented beats unless it is an essential dissonance<br /></li>
<li>resolve the melodies correctly (vertically and horizontally), e.g. the \(^{6}_{4}\) chords (2nd inversion triads) and the \(^{2}\) chords (3rd inversion seventh chords),<br /></li>
</ul>
<p>
among other general rules.<br />
</p>

<p>
The ideas that were used as guiding principles this fugue were as follows:<br />
</p>
<ul class="org-ul">
<li>Use and explore extensively the B-A-C-H motif and try to render this motif as melodious as possible<br /></li>
<li>Have a well-thought and well-built structure<br /></li>
<li>Employ the double/triple (invertible) counterpoint as much as possible.<br /></li>
</ul>
</div>
</div>

<div id="outline-container-org49f86d1" class="outline-2">
<h2 id="org49f86d1"><span class="section-number-2">2</span> Music/Score</h2>
<div class="outline-text-2" id="text-2">
<p>
The score can be found below, and the fugue can be played here:<br />
</p>
 <audio controls autoplay>
  <source src="./docs/assets/images/Fuga_I.mp3" type="audio/mpeg">
Your browser does not support the audio element.
</audio> 

<p alt="Fuga I image" title="Fuga I" align="center">
<img src="./docs/assets/images/scores/Fuga_I-1.png" alt="Fuga I image" title="Fuga I" align="center" /><br />
<img src="./docs/assets/images/scores/Fuga_I-2.png" alt="Fuga_I-2.png" /><br />
</p>
</div>
</div>

<div id="outline-container-org2cc3b53" class="outline-2">
<h2 id="org2cc3b53"><span class="section-number-2">3</span> Structural analysis</h2>
<div class="outline-text-2" id="text-3">
<p>
The structure diagram is shown in Figure <a href="#orgf0d0db3">1</a>. which shows schematically the location of the subject, countersubjects, episodes and the invertible counterpoints (inv. c.) amongst other indications. The scores with these indications can then be found in Subsection <a href="#org45da66c">3.2</a>. The structure of the fugue with entries and episodes are shown on the <a href="#orgcaecf68">first score</a>. The highlighted subject,<br />
countersubjects and the inverted counterpoint are detailed on the <a href="#orgbfc0c37">second score</a>.<br />
</p>
</div>

<div id="outline-container-org807a874" class="outline-3">
<h3 id="org807a874"><span class="section-number-3">3.1</span> Structure diagram</h3>
<div class="outline-text-3" id="text-3-1">

<div id="orgf0d0db3" class="figure">
<p><img src="./docs/assets/images/structure_table/fuga_1-analysis.png" alt="Fuga I image" title="Fuga I" align="center" /><br />
</p>
<p><span class="figure-number">Figure 1: </span>Structure diagram</p>
</div>

<p>
This fugue can be divided in three parts: measures 1-12 (in which all the voices enter successively, i.e., it is an exposition), measures 13-14 and measures 27-37. The final part of the fugue contains a stretto with an augmentation (in the upper voice) and a coda with a short (and repeated) episode that precedes it and that serves as a two-voice cadence. There is only one perfect authentic cadence in this piece with all the three voices, and it occurs at the end of the fugue. The voices collapse to just one voice at the very beginning of the coda, before opening up again with the successive entries of the subject in each voice.<br />
<br />
There is a notable deceptive cadence in measure 5 (V &rarr; VI [I]) and a quite brutal and sudden transition from F major to D minor in measure 24, whereas there is (only) one perfect authentic cadence in this piece with all the three voices&#x2013;it occurs at the end of the fugue which finishes with an Picardy third. The inverted counterpoint at the octave is profusely used in this fugue, and a voice is dropped from time to time at certain places in order to alleviate the texture of the fugue.<br />
</p>
</div>
</div>

<div id="outline-container-org45da66c" class="outline-3">
<h3 id="org45da66c"><span class="section-number-3">3.2</span> Score analysis</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-orgcaecf68" class="outline-4">
<h4 id="orgcaecf68"><span class="section-number-4">3.2.1</span> Entries/episodes</h4>
<div class="outline-text-4" id="text-3-2-1">
<p alt="Entries/episodes analysis image" title="Entries/episodes analysis" align="center">
<img src="./docs/assets/images/scores/Fuga_I-analyse-structure-1.png" alt="Entries/episodes analysis image" title="Entries/episodes analysis" align="center" /><br />
<img src="./docs/assets/images/scores/Fuga_I-analyse-structure-2.png" alt="Fuga_I-analyse-structure-2.png" /><br />
</p>
</div>
</div>

<div id="outline-container-orgbfc0c37" class="outline-4">
<h4 id="orgbfc0c37"><span class="section-number-4">3.2.2</span> Subjects/countersujects and invertible counterpoint</h4>
<div class="outline-text-4" id="text-3-2-2">
<p alt="Subjects/countersujects and invertible counterpoint image" title="Subjects/countersujects and invertible counterpoint" align="center">
<img src="./docs/assets/images/scores/Fuga_I-analyse-sujets+counterpoint-1.png" alt="Subjects/countersujects and invertible counterpoint image" title="Subjects/countersujects and invertible counterpoint" align="center" /><br />
<img src="./docs/assets/images/scores/Fuga_I-analyse-sujets+counterpoint-2.png" alt="Fuga_I-analyse-sujets+counterpoint-2.png" /><br />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-org143ace1" class="outline-2">
<h2 id="org143ace1"><span class="section-number-2">4</span> Specific details</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org570c1a2" class="outline-3">
<h3 id="org570c1a2"><span class="section-number-3">4.1</span> Zenith/nadir of the piece</h3>
<div class="outline-text-3" id="text-4-1">
<p>
The piece has a brief central part in the relative major (F major). The zenith of this fugue is in this F major section, which is generally in the higher pitch registry. The D minor section, in contrast, is much more grounded in the lower pitch registry.<br />
</p>
</div>
</div>

<div id="outline-container-org8aa6218" class="outline-3">
<h3 id="org8aa6218"><span class="section-number-3">4.2</span> The strong-beat tritone in the lower voices</h3>
<div class="outline-text-3" id="text-4-2">
<p>
In measure 9 (episode 2-1), the two lower voices form a tritone on the very first beat (<b>E</b> and \(\textbf{B}\flat\)) which is not allowed in principle (the fact that the dissonant interval is with the bass AND the fact that the dissonance is on the first beat). This is the only place in this fugue where such a dissonance occur, and this is to stress the B-A-C-H motif that enters with an augmentation with respect to the subject.<br />
</p>
</div>
</div>

<div id="outline-container-org3701064" class="outline-3">
<h3 id="org3701064"><span class="section-number-3">4.3</span> German sixth (übermässiger Quintsextakkord)</h3>
<div class="outline-text-3" id="text-4-3">

<div id="org4e88032" class="figure">
<p><img src="./docs/assets/images/german_sixth.png" alt="german_sixth.png" /><br />
</p>
<p><span class="figure-number">Figure 2: </span>(Suggested) German sixth chord without the fifth.</p>
</div>

<p>
The B-A-C-H motif is a chromatically difficult melodic/harmonic line to handle. This can give rise to many exciting melodic and harmonic possibilities in a freer setting of course, but it can be a difficult task within the rules of strict counterpoint.<br />
</p>

<p>
This motif sounds mysterious and very eerie when the third voice hasn't entered yet, as the harmonic suggestion is not yet clear without the third voice and the chromatic voices are very dissonant. However, the entry of the third voice suggests a very interesting harmonic progression, with the middle voice (the secound countersubject) having a delayed resolution after the B-A-C-H motif (the augmented interval within the middle voice should be followed by a contrary motion first).<br />
</p>

<p>
The <b>D\(\sharp\)</b> (<b>Dis</b>) suggests the <b>VII</b> degree of <b>E</b>, and one way of understanding this functionally is to think of it as the German sixth&#x2013;with the fifth omitted&#x2013;in the tonality of <b>E</b>, i.e., a chord with \(\sharp\text{IV}-\flat\text{VI}-\text{I (omitted)}-\text{III}\). It is then resolved in one of the traditional ways in the tonality of <b>A</b>.<br />
</p>
</div>
</div>

<div id="outline-container-org5e7501f" class="outline-3">
<h3 id="org5e7501f"><span class="section-number-3">4.4</span> Double sequence</h3>
<div class="outline-text-3" id="text-4-4">

<div id="org9db39d5" class="figure">
<p><img src="./docs/assets/images/double_sequence.png" alt="double_sequence.png" /><br />
</p>
<p><span class="figure-number">Figure 3: </span>(Suggested) German sixth chord without the fifth.</p>
</div>

<p>
This passage is a double sequence, where a pattern and an imitative sequence&#x2013;a sequence in which voices imitate other voices&#x2013;is again used as an (inclusive) sequence. The imitative sequence is built such that the alto/tenor voice in the middle has a dactyl against an anapaest successively: making a nod to the second half of the subject.<br />
</p>

<p>
Harmonically, the passage goes through the cycle of fifths "downwards". At the end of each measure, the last note of the middle voice is the seventh of the chords which should be resolved downwards by a half step (scale degree <b>IV</b> should, in principle, resolve down to <b>III</b>). However, as another voice (soprano) takes over the seventh of the chord and then resolves down correctly, the middle voice can go up a step to avoid a parallel octave. In this case, this also ensures that we have an inclusive sequence (i.e., in all the voices) by a step.<br />
</p>


<div id="org47a58b8" class="figure">
<p><img src="./docs/assets/images/double_sequence-end.png" alt="double_sequence-end.png" /><br />
</p>
<p><span class="figure-number">Figure 4: </span>Measure wrapping up the double sequence which is again an imitative sequence.</p>
</div>

<p>
Following the idea of <i>pattern &rarr; sequence &rarr; contrast</i> (or <i>idea - &rarr; repetition &rarr; contrast/altered repetition)</i>, the next measure pursues a different melodic motifs. However, one of them is a recall of one of the motifs from the double sequence which allows a certain continuity with the double sequence. This passage is also an imitative sequence with a series of imperfect consonances (thirds and sixths), making these three measures complex yet beautiful with a lot of structure and symmetry. They come back once more later in the fugue as a triple counterpoint.<br />
</p>
</div>
</div>
</div>

<div id="outline-container-org2826d6c" class="outline-2">
<h2 id="org2826d6c"><span class="section-number-2">5</span> Appendix: Computational Musicology</h2>
<div class="outline-text-2" id="text-5">
<p>
We now analyse the fugue with <a href="https://web.mit.edu/music21/"><code>music21</code></a>, a <i>python</i> package developed by MIT for computer-aided musicology.<br />
</p>
</div>
<div id="outline-container-orgd7fe132" class="outline-3">
<h3 id="orgd7fe132"><span class="section-number-3">5.1</span> Piano roll and other graphics</h3>
<div class="outline-text-3" id="text-5-1">
<p>
First initialise <code>music21</code>:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">from</span> music21 <span class="org-keyword">import</span> *
<span class="org-comment-delimiter"># </span><span class="org-comment">environment.set('musescoreDirectPNGPath', '~/.myscript/MuseScore-3.6.2-x86_64.AppImage')</span>

<span class="org-variable-name">path</span> = <span class="org-string">'../music21/Fuga I analysis with music21.musicxml'</span>
<span class="org-variable-name">fugue</span> = converter.parse(path)
</pre>
</div>

<p>
We can then plot the piano roll:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-comment-delimiter"># </span><span class="org-comment">fugue.plot('pianoroll')</span>

<span class="org-variable-name">roll</span> = graph.plot.HorizontalBarPitchSpaceOffset(fugue)
<span class="org-variable-name">roll.title</span> = <span class="org-string">'Piano roll of Fuga I'</span>
<span class="org-variable-name">roll.figureSize</span> = (12, 6)
roll.run()
</pre>
</div>


<div class="figure">
<p><img src="./docs/assets/images/pianoRoll.png" alt="pianoRoll.png" /><br />
</p>
</div>

<p>
And plot it with pitch classes this time:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-comment-delimiter"># </span><span class="org-comment">fugue.plot('pianoroll')</span>

<span class="org-variable-name">roll</span> = graph.plot.HorizontalBarPitchClassOffset(fugue)
<span class="org-variable-name">roll.title</span> = <span class="org-string">'Piano roll of Fuga I'</span>
<span class="org-variable-name">roll.figureSize</span> = (12, 6)
roll.run()
</pre>
</div>


<div class="figure">
<p><img src="./docs/assets/images/pianoRoll.png" alt="pianoRoll.png" /><br />
</p>
</div>

<p>
By using the spline interpolation, we can plot the notes as smoothed-out curves:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np
<span class="org-keyword">import</span> matplotlib.pyplot <span class="org-keyword">as</span> plt
<span class="org-keyword">from</span> scipy <span class="org-keyword">import</span> interpolate

<span class="org-variable-name">fig</span> = plt.figure()
<span class="org-variable-name">subplot</span> = fig.add_subplot(1, 1, 1)

<span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span>(<span class="org-builtin">len</span>(fugue.parts)):
    <span class="org-variable-name">top</span> = fugue.parts[i].flat.notes
    <span class="org-variable-name">y</span> = [n.pitch.ps <span class="org-keyword">for</span> n <span class="org-keyword">in</span> top]
    <span class="org-variable-name">x</span> = [n.offset + n.quarterLength/2.0 <span class="org-keyword">for</span> n <span class="org-keyword">in</span> top]

    <span class="org-variable-name">tick</span> = interpolate.splrep(x, y, s=0)
    <span class="org-variable-name">xnew</span> = np.arange(x[0], <span class="org-builtin">max</span>(x), 0.01)
    <span class="org-variable-name">ynew</span> = interpolate.splev(xnew, tick, der=0)

    subplot.plot(xnew, ynew)
    subplot.spines[<span class="org-string">'top'</span>].set_color(<span class="org-string">'none'</span>)
    subplot.spines[<span class="org-string">'right'</span>].set_color(<span class="org-string">'none'</span>)

plt.title(<span class="org-string">'Fuga I motion'</span>)

plt.show()
</pre>
</div>


<div class="figure">
<p><img src="./docs/assets/images/Pitch-interpolation.png" alt="Pitch-interpolation.png" /><br />
</p>
</div>
</div>
</div>

<div id="outline-container-orgf39049d" class="outline-3">
<h3 id="orgf39049d"><span class="section-number-3">5.2</span> Key center</h3>
<div class="outline-text-3" id="text-5-2">
<p>
The key is found using the <a href="https://rnhart.net/articles/key-finding/">Krumhansl-Schmuckler key-finding algorithm</a> which uses the correlation coefficient<br />
\[R = \frac{\sum\limits_{i=1}^{n}(x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum\limits_{i=1}^{n}(x_i - \bar{x})^2 \sum\limits_{i=1}^{n}(y_i - \bar{y})^2}}\]<br />
in which one coordinate is the <b>profile</b> of each note in a major or minor key and the other coordinate is the <b>total duration</b> of each pitch class. The profiles have been empirically established values.<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">tonality</span> = fugue.analyze(<span class="org-string">'key'</span>)
tonality
</pre>
</div>

<pre class="example">
&lt;music21.key.Key of d minor&gt;

</pre>

<p>
The correlation coefficient is then given by<br />
</p>

<div class="org-src-container">
<pre class="src src-python">tonality.correlationCoefficient
</pre>
</div>

<pre class="example">
# Out[213]:
: 0.9486855347153584

</pre>

<p>
The correlation coefficient of other candidate keys:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">import</span> matplotlib.pyplot <span class="org-keyword">as</span> plt
<span class="org-keyword">import</span> numpy <span class="org-keyword">as</span> np
plt.figure(figsize=(12, 6))

<span class="org-variable-name">alternateKeys</span> = [tonality] + tonality.alternateInterpretations

<span class="org-variable-name">keys</span> = [<span class="org-builtin">str</span>(alternateKeys[i]).split()[0] <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span>(<span class="org-builtin">len</span>(alternateKeys))]
<span class="org-variable-name">corrCoeffs</span> = [alternateKeys[i].correlationCoefficient <span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span>(<span class="org-builtin">len</span>(alternateKeys))]

<span class="org-variable-name">xPos</span> = np.arange(<span class="org-builtin">len</span>(keys))
plt.xticks(xPos, keys)

plt.xlabel(<span class="org-string">'Key'</span>)
plt.ylabel(<span class="org-string">'Correlation coefficient'</span>)
plt.title(<span class="org-string">'Correlation coefficients of the candidate keys'</span>)
plt.tick_params(axis = <span class="org-string">"x"</span>, bottom = <span class="org-constant">False</span>)

plt.bar(xPos, corrCoeffs, align=<span class="org-string">'center'</span>, width=0.8)

plt.show()
</pre>
</div>


<div class="figure">
<p><img src="docs/assets/images/tonal_probability.png" alt="tonal_probability.png" /><br />
</p>
</div>

<p>
The histogram of the pitch classes:<br />
</p>

<div class="org-src-container">
<pre class="src src-python">fugue.plot(<span class="org-string">'histogram'</span>, <span class="org-string">'pitchClass'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./docs/assets/images/histogram-pitchClass.png" alt="histogram-pitchClass.png" /><br />
</p>
</div>

<p>
The histogram of all the pitches:<br />
</p>

<div class="org-src-container">
<pre class="src src-python">fugue.plot(<span class="org-string">'histogram'</span>, <span class="org-string">'pitch'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./docs/assets/images/histogram-pitch.png" alt="histogram-pitch.png" /><br />
</p>
</div>

<p>
The scatter plot with measures and pitch classes:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">scatter</span> = graph.plot.ScatterPitchClassOffset(fugue)
<span class="org-variable-name">scatter.title</span> = <span class="org-string">'Fuga I and its notes'</span>
<span class="org-variable-name">scatter.figureSize</span> = (12, 6)
scatter.run()
</pre>
</div>


<div class="figure">
<p><img src="./docs/assets/images/Scatter-pitchClass.png" alt="Scatter-pitchClass.png" /><br />
</p>
</div>

<p>
The scatter plot with the pitch class by quarter length:<br />
</p>

<div class="org-src-container">
<pre class="src src-python">fugue.plot(<span class="org-string">'scatter'</span>, <span class="org-string">'pitchClass'</span>, <span class="org-string">'quarterLength'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./docs/assets/images/scatter-pitchClass-quarterLength.png" alt="scatter-pitchClass-quarterLength.png" /><br />
</p>
</div>

<p>
And in 3D:<br />
</p>

<div class="org-src-container">
<pre class="src src-python">fugue.plot(<span class="org-string">'3dbars'</span>)
</pre>
</div>


<div class="figure">
<p><img src="./docs/assets/images/scatter-pitchClass-quarterLength-3D.png" alt="scatter-pitchClass-quarterLength-3D.png" /><br />
</p>
</div>
</div>
</div>

<div id="outline-container-org6c25ce9" class="outline-3">
<h3 id="org6c25ce9"><span class="section-number-3">5.3</span> Chords</h3>
<div class="outline-text-3" id="text-5-3">
<p>
We now combine the three voices into <code>Chord</code> objects:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-comment-delimiter"># </span><span class="org-comment">Chordify fugue</span>
<span class="org-variable-name">chords</span> = fugue.chordify()

<span class="org-comment-delimiter"># </span><span class="org-comment">Insert chords in fugue</span>
fugue.insert(0, chords)

<span class="org-comment-delimiter"># </span><span class="org-comment">Chords closed position</span>
<span class="org-keyword">for</span> c <span class="org-keyword">in</span> chords.recurse().getElementsByClass(<span class="org-string">'Chord'</span>):
    c.closedPosition(forceOctave=4, inPlace=<span class="org-constant">True</span>)

<span class="org-comment-delimiter"># </span><span class="org-comment">Add Roman numeral analysis</span>
<span class="org-keyword">for</span> c <span class="org-keyword">in</span> chords.recurse().getElementsByClass(<span class="org-string">'Chord'</span>):
    <span class="org-variable-name">rn</span> = roman.romanNumeralFromChord(c, key.Key(<span class="org-string">'d'</span>))
    c.addLyric(<span class="org-builtin">str</span>(rn.figure))

<span class="org-comment-delimiter"># </span><span class="org-comment">Show</span>
fugue.measures(0,12).show()
</pre>
</div>


<div class="figure">
<p><img src="./docs/assets/images/romanAnalysis.png" alt="romanAnalysis.png" /><br />
</p>
</div>

<p>
One possibility would be as follows:<br />
</p>
<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">chordsFlat</span> = chords.flat
<span class="org-variable-name">onlyChords</span> = chordsFlat.getElementsByClass(<span class="org-string">'Chord'</span>)

<span class="org-variable-name">displayPart</span> = stream.Part(<span class="org-builtin">id</span>=<span class="org-string">'displayPart'</span>)

<span class="org-keyword">def</span> <span class="org-function-name">appendChordPairs</span>(thisChord, nextChord):
<span class="org-comment-delimiter">#    </span><span class="org-comment">if ((thisChord.isTriad() is True or</span>
<span class="org-comment-delimiter">#            </span><span class="org-comment">thisChord.isSeventh() is True) and</span>
<span class="org-comment-delimiter">#                </span><span class="org-comment">thisChord.root().name == 'D'):</span>
    <span class="org-variable-name">closePositionThisChord</span> = thisChord.closedPosition(forceOctave=4)
    <span class="org-variable-name">closePositionNextChord</span> = nextChord.closedPosition(forceOctave=4)

    <span class="org-variable-name">m</span> = stream.Measure()
    m.append(closePositionThisChord)
    m.append(closePositionNextChord)
    displayPart.append(m)

<span class="org-keyword">for</span> i <span class="org-keyword">in</span> <span class="org-builtin">range</span>(<span class="org-builtin">len</span>(onlyChords) - 1):
    <span class="org-variable-name">thisChord</span> = onlyChords[i]
    <span class="org-variable-name">nextChord</span> = onlyChords[i + 1]
    appendChordPairs(thisChord, nextChord)

displayPart.show()
</pre>
</div>

<p>
But we will do something simpler and better adapted to our case:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-variable-name">chordsFlat</span> = chords.flat
<span class="org-variable-name">onlyChords</span> = chordsFlat.getElementsByClass(<span class="org-string">'Chord'</span>)

onlyChords.measures(0,37).show()
</pre>
</div>


<div class="figure">
<p><img src="./docs/assets/images/romanAnalysis-onlyChords.png" alt="romanAnalysis-onlyChords.png" /><br />
</p>
</div>

<p>
With the chords, it is possible to analyse the key of each measures:<br />
</p>

<div class="org-src-container">
<pre class="src src-python"><span class="org-keyword">for</span> m <span class="org-keyword">in</span> chords.getElementsByClass(<span class="org-string">'Measure'</span>):
    <span class="org-variable-name">k</span> = m.analyze(<span class="org-string">'key'</span>)
    <span class="org-keyword">print</span>(m.number, k)
</pre>
</div>

<pre class="example">
1 a minor
2 b- minor
3 d minor
4 a minor
5 d minor
6 g minor
7 d minor
8 d minor
9 a minor
10 D major
11 C major
12 F major
13 F major
14 g minor
15 F major
16 d minor
17 d minor
18 d minor
19 d minor
20 d minor
21 a minor
22 D major
23 C major
24 F major
25 d minor
26 F major
27 G major
28 d minor
29 a minor
30 A major
31 d minor
32 d minor
33 d minor
34 d minor
35 A major
36 D major
37 b minor
</pre>

<p>
<br />
<br />
<br />
</p>

<p>
This webpage was built with Org mode, using <a href="https://github.com/fniessen/org-html-themes">https://github.com/fniessen/org-html-themes</a> and <a href="https://systemcrafters.net/publishing-websites-with-org-mode/building-the-site/">https://systemcrafters.net/publishing-websites-with-org-mode/building-the-site/</a> for publishing it.<br />
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Francisco Kim</p>
<p class="date">Created: 2022-01-27 Thu 20:56</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
